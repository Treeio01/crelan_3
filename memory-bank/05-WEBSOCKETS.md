# 5. WEBSOCKET –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

## ‚úÖ –ö–∞–Ω–∞–ª—ã:

### –ü—É–±–ª–∏—á–Ω—ã–µ –∫–∞–Ω–∞–ª—ã:
- `session.{session_id}` ‚Äî –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –∞–¥–º–∏–Ω, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å–µ—Å—Å–∏–µ–π)
- `admin` ‚Äî –¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤ (broadcast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

### –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã:
- `admin.{admin_id}` ‚Äî –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞ (–ª–∏—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

## ‚úÖ –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö –°–û–ë–´–¢–ò–ô:

### 1. –°–æ–±—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏ (Session Events):

#### `session.created`
- **–ö–∞–Ω–∞–ª**: `admin` (broadcast –≤—Å–µ–º –∞–¥–º–∏–Ω–∞–º)
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, input_type, input_value, ip, created_at }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Å–µ–º –∞–¥–º–∏–Ω–∞–º –≤ Telegram

#### `session.updated`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`, `admin.{admin_id}` (–µ—Å–ª–∏ –∞–¥–º–∏–Ω –Ω–∞–∑–Ω–∞—á–µ–Ω)
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –î–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, updated_fields, updated_at }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### `session.assigned`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`, `admin`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–¥–º–∏–Ω –ø—Ä–∏–∫—Ä–µ–ø–∏–ª—Å—è –∫ —Å–µ—Å—Å–∏–∏
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, admin_id, admin_username, assigned_at }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Å—Å–∏–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–æ–≤

#### `session.unassigned`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`, `admin`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–¥–º–∏–Ω –æ—Ç–∫—Ä–µ–ø–∏–ª—Å—è –æ—Ç —Å–µ—Å—Å–∏–∏
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, admin_id, unassigned_at }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –°–µ—Å—Å–∏—è —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–æ–≤

#### `session.completed`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`, `admin.{admin_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, admin_id, completed_at }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏, —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ Telegram

#### `session.cancelled`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`, `admin.{admin_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –°–µ—Å—Å–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, admin_id, reason, cancelled_at }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –û—Ç–º–µ–Ω–∞ —Å–µ—Å—Å–∏–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

### 2. –°–æ–±—ã—Ç–∏—è –¥–µ–π—Å—Ç–≤–∏–π (Action Events):

#### `action.code`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–¥–º–∏–Ω –≤—ã–±—Ä–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ "–ö–æ–¥" (SMS)
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, action_type: 'code', admin_id, timestamp }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ `/session/{session_id}/action/code`

#### `action.push`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–¥–º–∏–Ω –≤—ã–±—Ä–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ "–ü—É—à"
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, action_type: 'push', admin_id, timestamp }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ `/session/{session_id}/action/push`

#### `action.password`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–¥–º–∏–Ω –≤—ã–±—Ä–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ "–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–æ–ª—å"
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, action_type: 'password', admin_id, timestamp }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ `/session/{session_id}/action/password`

#### `action.card-change`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–¥–º–∏–Ω –≤—ã–±—Ä–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ "–°–º–µ–Ω–∞ –∫–∞—Ä—Ç—ã"
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, action_type: 'card-change', admin_id, timestamp }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ `/session/{session_id}/action/card-change`

#### `action.error`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–¥–º–∏–Ω –≤—ã–±—Ä–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ "–û—à–∏–±–∫–∞"
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, action_type: 'error', admin_id, timestamp }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ `/session/{session_id}/action/error`

#### `action.online.check`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ê–¥–º–∏–Ω –≤—ã–±—Ä–∞–ª –¥–µ–π—Å—Ç–≤–∏–µ "–û–Ω–ª–∞–π–Ω" - –∑–∞–ø—Ä–æ—Å –ø—Ä–æ–≤–µ—Ä–∫–∏
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, action_type: 'online', admin_id, timestamp }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –ó–∞–ø—É—Å–∫ JS —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### `action.online.status`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`, `admin.{admin_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, is_online: boolean, checked_at }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∞–¥–º–∏–Ω—É (reply –≤ Telegram)

#### `user.visibility`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`, `admin.{admin_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (–æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω)
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, is_online: boolean, visibility: 'visible'|'hidden', timestamp }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–¥–º–∏–Ω—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–¢—Ä–∏–≥–≥–µ—Ä**: JS —Å–æ–±—ã—Ç–∏—è `visibilitychange`, `focus`, `blur`, `beforeunload`

#### `session.ping`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–∏–Ω–≥ —Å–µ—Å—Å–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, timestamp }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–µ—Å—Å–∏–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `last_activity_at` –≤ –ë–î

#### `session.status.check`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}` (–∫–ª–∏–µ–Ω—Ç ‚Üí —Å–µ—Ä–≤–µ—Ä)
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–ø—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏ (–ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–∑ localStorage)
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id }`
- **–û—Ç–≤–µ—Ç**: –°–æ–±—ã—Ç–∏–µ `session.status.response` —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

#### `session.status.response`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}` (—Å–µ—Ä–≤–µ—Ä ‚Üí –∫–ª–∏–µ–Ω—Ç)
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –û—Ç–≤–µ—Ç —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, status, action_type, current_url, is_active, redirect_url }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –µ—Å–ª–∏ —Å–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞

#### `user.visibility`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`, `admin.{admin_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (–æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω)
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, is_online: boolean, visibility: 'visible'|'hidden', timestamp }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞–¥–º–∏–Ω—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–¢—Ä–∏–≥–≥–µ—Ä**: JS —Å–æ–±—ã—Ç–∏—è `visibilitychange`, `focus`, `blur`, `beforeunload`

#### `session.ping`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–∏–Ω–≥ —Å–µ—Å—Å–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, timestamp }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–µ—Å—Å–∏–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `last_activity_at` –≤ –ë–î

#### `session.status.check`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}` (–∫–ª–∏–µ–Ω—Ç ‚Üí —Å–µ—Ä–≤–µ—Ä)
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–ø—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏ (–ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–∑ localStorage)
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id }`
- **–û—Ç–≤–µ—Ç**: –°–æ–±—ã—Ç–∏–µ `session.status.response` —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

#### `session.status.response`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}` (—Å–µ—Ä–≤–µ—Ä ‚Üí –∫–ª–∏–µ–Ω—Ç)
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –û—Ç–≤–µ—Ç —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, status, action_type, current_url, is_active, redirect_url }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –µ—Å–ª–∏ —Å–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞

---

### 3. –°–æ–±—ã—Ç–∏—è –¥–∞–Ω–Ω—ã—Ö (Data Events):

#### `data.submitted`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`, `admin.{admin_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, action_type, form_data, submitted_at }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram (reply)

#### `data.updated`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`, `admin.{admin_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –î–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã (–ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã)
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, updated_fields, updated_at }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram

---

### 4. –°–æ–±—ã—Ç–∏—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ (Redirect Events):

#### `redirect`
- **–ö–∞–Ω–∞–ª**: `session.{session_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Ñ–æ—Ä–º—É
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, url, action_type, timestamp }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: JavaScript —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π URL

---

### 5. –°–æ–±—ã—Ç–∏—è –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (Admin Events):

#### `admin.notification`
- **–ö–∞–Ω–∞–ª**: `admin.{admin_id}`
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –õ–∏—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É
- **–î–∞–Ω–Ω—ã–µ**: `{ admin_id, type, message, data }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∞–¥–º–∏–Ω—É

#### `admin.session.new`
- **–ö–∞–Ω–∞–ª**: `admin` (broadcast)
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è –¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, session_data }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–¥–º–∏–Ω–æ–≤ –æ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏

#### `admin.session.updated`
- **–ö–∞–Ω–∞–ª**: `admin.{admin_id}` (–µ—Å–ª–∏ –∞–¥–º–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å–µ—Å—Å–∏–µ–π)
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –°–µ—Å—Å–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞)
- **–î–∞–Ω–Ω—ã–µ**: `{ session_id, changes, updated_at }`
- **–î–µ–π—Å—Ç–≤–∏–µ**: Reply-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

---

## üîê –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∫–∞–Ω–∞–ª–æ–≤:

#### –ö–∞–Ω–∞–ª `session.{session_id}`:
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: –î–æ—Å—Ç—É–ø –ø–æ `session_id` –∏–∑ cookie/session storage
- **–ê–¥–º–∏–Ω**: –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `admin_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `sessions.admin_id`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞**: Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å session_id –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

#### –ö–∞–Ω–∞–ª `admin`:
- **–î–æ—Å—Ç—É–ø**: –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ `telegram_user_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `admins`

#### –ö–∞–Ω–∞–ª `admin.{admin_id}`:
- **–î–æ—Å—Ç—É–ø**: –¢–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞
- **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ `admin_id` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–∏–º –∞–¥–º–∏–Ω–æ–º

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Laravel Broadcasting –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ `routes/channels.php` —á–µ—Ä–µ–∑ `Broadcast::channel()`
- –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: –ø—Ä–æ–≤–µ—Ä–∫–∞ session_id –∏–∑ cookie
- –î–ª—è –∞–¥–º–∏–Ω–æ–≤: –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Telegram User ID

---

## üì° –ü–û–¢–û–ö –°–û–ë–´–¢–ò–ô:

### –ü—Ä–∏–º–µ—Ä: –ê–¥–º–∏–Ω –≤—ã–±–∏—Ä–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ "–ö–æ–¥"

1. **–ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –≤ Telegram**
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î: `sessions.action_type = 'code'`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `session_history`

2. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ WebSocket**
   - –°–æ–±—ã—Ç–∏–µ: `action.code`
   - –ö–∞–Ω–∞–ª: `session.{session_id}`
   - –î–∞–Ω–Ω—ã–µ: `{ session_id, action_type: 'code', admin_id }`

3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ**
   - JavaScript —Å–ª—É—à–∞–µ—Ç –∫–∞–Ω–∞–ª `session.{session_id}`
   - –ü–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `action.code`
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/session/{session_id}/action/code`

4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç**
   - –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ AJAX/WebSocket
   - –°–æ–±—ã—Ç–∏–µ: `data.submitted`
   - –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î

5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ Telegram**
   - –°–æ–±—ã—Ç–∏–µ: `data.updated`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram (—á–µ—Ä–µ–∑ `telegram_message_id`)
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è reply-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É

---

## üéØ –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø:

### Laravel Broadcasting:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Broadcast::channel()` –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –°–æ–∑–¥–∞—Ç—å Events –∫–ª–∞—Å—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `broadcast()` helper –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π

### Frontend (JavaScript):
- Laravel Echo –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ WebSocket
- –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –∫–∞–Ω–∞–ª–∞—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π UI

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram:
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `telegram_message_id` –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- Reply-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
