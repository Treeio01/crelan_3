# 6. –§–û–†–ú–´ –ò –†–û–£–¢–ò–ù–ì

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:
- –ì–ª–∞–≤–Ω–∞—è `/` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏
- –†–æ—É—Ç—ã –¥–ª—è API (—Ñ–æ—Ä–º–∞—Ç –Ω–∞ –≤—ã–±–æ—Ä)
- –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –ë–î
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –•—Ä–∞–Ω–∏—Ç—å `telegram_message_id` –≤ —Å–µ—Å—Å–∏–∏
- –†–∞–∑–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (–ø–æ–∫–∞–∂–µ—à—å –ø–æ–∑–∂–µ)

## ‚úÖ –†–ï–®–ï–ù–û:

### 6.1. –§–æ—Ä–º–∞—Ç —Ä–æ—É—Ç–æ–≤:
- ‚úÖ **–†–æ—É—Ç—ã**: `/session/{session_id}/action/{action_type}`
- ‚úÖ **LocalStorage**: –°–æ—Ö—Ä–∞–Ω—è—Ç—å `session_id` –≤ localStorage –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏**: –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é `/` –ø—Ä–æ–≤–µ—Ä—è—Ç—å localStorage
  - –ï—Å–ª–∏ –µ—Å—Ç—å `session_id` ‚Üí –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ API
  - –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ç–µ–∫—É—â—É—é —Ñ–æ—Ä–º—É/—Å–æ—Å—Ç–æ—è–Ω–∏–µ
  - –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚Üí —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é

### 6.2. –í–∞–ª–∏–¥–∞—Ü–∏—è:
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ**: –î–∞ (–±—É–¥–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–æ—Ä–º)
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –±—ç–∫–µ**: –î–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –±—É–¥–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–æ—Ä–º)

### 6.3. –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã:
- ‚úÖ **–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å "–û–∂–∏–¥–∞–Ω–∏–µ/–û–±—Ä–∞–±–æ—Ç–∫–∞"** –ø–æ–∫–∞ –∞–¥–º–∏–Ω –Ω–µ –≤—ã–±–µ—Ä–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏/–æ–∂–∏–¥–∞–Ω–∏—è
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–æ–º ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Ñ–æ—Ä–º—É –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

### 6.4. –ó–∞—â–∏—Ç–∞ –¥–æ—Å—Ç—É–ø–∞:
- ‚ö†Ô∏è **–ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ** - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞

## üìã –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏:

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π –≤ localStorage:
```javascript
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ session_id
localStorage.setItem('session_id', sessionId);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
const sessionId = localStorage.getItem('session_id');
if (sessionId) {
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ API
    // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–∞ - —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
}
```

### –ü–∏–Ω–≥ —Å–µ—Å—Å–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
- **API endpoint**: `GET /api/session/{session_id}/status`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: `{ status, action_type, current_url, is_active }`
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –ø–∏–Ω–≥**: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–µ—Å—Å–∏–∏

### –û–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- **JS –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏**: 
  - `visibilitychange` - –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –≤–∫–ª–∞–¥–∫—É
  - `focus` / `blur` - –∫–æ–≥–¥–∞ –æ–∫–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç/—Ç–µ—Ä—è–µ—Ç —Ñ–æ–∫—É—Å
  - `beforeunload` - –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
- **–û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ WebSocket**:
  - –°–æ–±—ã—Ç–∏–µ: `online.status` –∏–ª–∏ `user.visibility`
  - –î–∞–Ω–Ω—ã–µ: `{ session_id, is_online: boolean, visibility: 'visible'|'hidden' }`
  - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞

### –†–æ—É—Ç—ã:

#### –ü—É–±–ª–∏—á–Ω—ã–µ —Ä–æ—É—Ç—ã:
- `GET /` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏)
- `GET /session/{session_id}/action/{action_type}` - —Ñ–æ—Ä–º—ã –¥–µ–π—Å—Ç–≤–∏–π
- `POST /api/session/{session_id}/submit` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
- `GET /api/session/{session_id}/status` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏

#### –ü—Ä–∏–º–µ—Ä—ã —Ä–æ—É—Ç–æ–≤:
- `/session/abc123/action/code` - —Ñ–æ—Ä–º–∞ SMS –∫–æ–¥–∞
- `/session/abc123/action/push` - —Ñ–æ—Ä–º–∞ –ü–£–®–∞
- `/session/abc123/action/password` - —Ñ–æ—Ä–º–∞ –ø–∞—Ä–æ–ª—è
- `/session/abc123/action/card-change` - —Ñ–æ—Ä–º–∞ —Å–º–µ–Ω—ã –∫–∞—Ä—Ç—ã
- `/session/abc123/action/error` - —Ñ–æ—Ä–º–∞ –æ—à–∏–±–∫–∏

### –°–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏ –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã:
- **pending** ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π, –æ–∂–∏–¥–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∞
- **processing** ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Ñ–æ—Ä–º–µ, –∞–¥–º–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å–µ—Å—Å–∏–µ–π
- **completed** ‚Üí —Å–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- **cancelled** ‚Üí —Å–µ—Å—Å–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞, –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–º–µ–Ω–µ

### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–∂–∏–¥–∞–Ω–∏—è:
- –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
  - –°–ø–∏–Ω–Ω–µ—Ä/–ª–æ–∞–¥–µ—Ä
  - –¢–µ–∫—Å—Ç "–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ..."
  - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ñ–æ—Ä–º—ã –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–æ–º ‚Üí —Å–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä, –ø–æ–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Ñ–æ—Ä–º—É
